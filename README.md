# HW1: –ù–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –ø—É—Ç–∏ –≤ Env Gym

### ü§ì Task:

1. –ü–æ–∑–Ω–∞–∫–æ–º—å—Ç–µ—Å—å —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π [OpenAI Gym](https://gym.openai.com/read-only.html). –í–∞—à–∞ –∑–∞–¥–∞—á–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —Å–≤–æ–µ–≥–æ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –∑–∞–¥–∞—á–∏ –ø–æ–∏—Å–∫–∞ –ø—É—Ç–∏ –≤ –ª–∞–±–∏—Ä–∏–Ω—Ç–µ.

2. –í–∞—à–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ (—É–Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–Ω–æ–µ –æ—Ç –∫–ª–∞—Å—Å–∞ Env) –¥–æ–ª–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—Ç—å —Å–æ–±–æ–π –ª–∞–±–∏—Ä–∏–Ω—Ç —Ä–∞–∑–º–µ—Ä–æ–º 20x20, –≤ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–¥–∞–Ω–æ –Ω–∞—á–∞–ª—å–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –∏ –∏–∑–≤–µ—Å—Ç–Ω–æ –µ–≥–æ —Ü–µ–ª–µ–≤–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –æ–Ω –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–π—Ç–∏. –ö–∞—Ä—Ç–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ –≤–∏–¥–µ —á–µ—Ç—ã—Ä–µ—Ö—Å–≤—è–∑–Ω–æ–π –∫–ª–µ—Ç–æ—á–Ω–æ–π —Å—Ä–µ–¥—ã. –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ –≤ —ç—Ç–æ–º –ø—É–Ω–∫—Ç–µ - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏—è –∑–∞ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞. –ù—É–∂–Ω–æ –ø—Ä–∏–¥—É–º–∞—Ç—å —Å–≤–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–ª –±—ã –∞–≥–µ–Ω—Ç—É —É—Å–ø–µ—à–Ω–æ —É—á–∏—Ç—å—Å—è –Ω–∞—Ö–æ–¥–∏—Ç—å –ø—É—Ç—å. –ù–µ –∑–∞–±—É–¥—å—Ç–µ —à—Ç—Ä–∞—Ñ–æ–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–∞ –∑–∞ —É–¥–∞—Ä—ã –æ–± —Å—Ç–µ–Ω—ã.

3. –î–ª—è –æ–±—É—á–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞ –≤–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä—è–¥ –∫–∞—Ä—Ç —Å –Ω–∞–±–æ—Ä–æ–º –Ω–∞—á–∞–ª—å–Ω–æ–π –∏ –∫–æ–Ω–µ—á–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ - –¥–ª—è —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–æ–¥–æ–º –∏–∑ [Task generation](https://github.com/cog-isa/isyt2017rl/tree/master/baseline/prepare).

4. –°–æ–∑–¥–∞—Ç—å —Å–≤–æ–µ–≥–æ –∞–≥–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –æ–±—É—á–∞—Ç—å—Å—è –ø–æ —Ä–µ–≤–∞—Ä–¥–∞–º –∏ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –ø–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—é (–≤—Å–µ–≥–æ –∏—Ö 4) –¥–æ —Ü–µ–ª–µ–≤–æ–π –ø–æ–∑–∏—Ü–∏–∏. –ú–æ–∂–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –æ–¥–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–µ 100 –∏–ª–∏ 500.

5. –í –∫–∞—á–µ—Å—Ç–≤–µ –º–æ–¥–µ–ª–∏ –æ–±—É—á–µ–Ω–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–±—ã—á–Ω—É—é –¥–≤—É—Å–ª–æ–π–Ω—É—é –Ω–µ–π—Ä–æ—Å–µ—Ç—å –∏–ª–∏ Q-—Ç–∞–±–ª–∏—Ü—É.

6. –ü–æ—Å—Ç–∞—Ä–∞–π—Ç–µ—Å—å –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä —Å –ø–æ–º–æ—â—å—é matplotlib.

7. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è Baseline. –¢–∞–º –≤–∞–º –º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è CPython –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±—ã—Å—Ç—Ä–æ–≥–æ –∫–æ–¥–∞ - —ç—Ç–æ –æ–¥–Ω–æ –∏–∑ —á–∞—Å—Ç–µ–π –∑–∞–¥–∞–Ω–∏—è —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å –Ω–∏–º.

   #### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:

   *–∫ –ø—É–Ω–∫—Ç—É 4:* –û–≥—Ä–∞–Ω–∏—á–∏–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞–≥–æ–≤ –æ–¥–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –Ω–∞ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–µ –¥–æ 500;
   *–∫ –ø—É–Ω–∫—Ç—É 5*: –í –∫–∞—á–µ—Å—Ç–≤–µ –º–æ–¥–µ–ª–∏ –æ–±—É—á–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è *Q-learning —Å –Ω–µ–π—Ä–æ–Ω–∫–æ–π (–æ–Ω –∂–µ deep Q-learning)*;
   *–∫ –ø—É–Ω–∫—Ç—É 6:* –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å –ø–æ–º–æ—â—å—é matplotlib;
   *–∫ –ø—É–Ω–∫—Ç—É 7:* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è [Baseline](https://github.com/cog-isa/isyt2017rl).

   –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ–π—Ä–æ–Ω–∫–æ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è [pytorch](http://pytorch.org). 

## üïπ Install

```sudo pip install -r requirements.txt
$ git clone ///
$ cd baseline/ 

$ virtualenv -p python2 venv
$ . venv/bin/activate 
 
$ pip install -r requirements.txt
$ python setup.py install
$ ./build_cythob.sh

$ python train.py
$ python test.py
```



## üìñ General:

**1. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?**
   –í *Q-Learning Algorithm* —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è *Q(s,a)*, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–Ω–∞—á–∏–º–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è. –î–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞ *Deep Q-Learning*  –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ–π—Ä–æ–Ω–Ω—É—é —Å–µ—Ç—å –¥–ª—è –∞–ø–ø—Ä–æ–∫—Å–∏–º–∞—Ü–∏–∏ *Q(s,a)* –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è. 
   ‚Äã

   1) –ü–æ–ª—É—á–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ *s*;
   2) –ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞–µ–º –Ω–µ–π—Ä–æ–Ω–∫–æ–π *Q(s, a)* –¥–ª—è –∫–∞–∂–¥–æ–≥–æ *a*, –¥–µ–ª–∞–µ–º —à–∞–≥ *eps-–∂–∞–¥–Ω–æ*;
   3) –ü–æ–ª—É—á–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É –∏ –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ;
   4) –û–±–Ω–æ–≤–ª—è–µ–º –≤–µ—Å–∞ –Ω–µ–π—Ä–æ–Ω–∫–∏ –≤–æ—Ç —á–µ—Ä–µ–∑ —Ç–∞–∫–æ–π *loss*:

   ![2018-02-25 21.43.19](https://i.imgur.com/SxmoIGw.jpg)

   ‚òû –ï—Å–ª–∏ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º esp-–∂–∞–¥–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º, —Ç–æ –ø–æ—á–µ–º—É –æ–Ω –≤—Å–µ —Ä–∞–≤–Ω–æ –æ–ø—Ç–∏–º–∞–ª–µ–Ω? 

   –î–µ–π—Å—Ç–≤–∏–µ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é Œµ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å–ª—É—á–∞–π–Ω–æ, –∞ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 1 ‚àí Œµ –∫–∞–∫ argmax_{a}Q(s,a). –≠—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π, Œµ –ø—Ä–∏ —ç—Ç–æ–º –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è. 

   ‚Äã

   –ù–µ–π—Ä–æ–Ω–∫–∞ –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:
   ![2018-02-25 22.57.18](https://i.imgur.com/pikpv4B.jpg)

   –ù–∞ –≤—Ö–æ–¥ –æ–Ω–∞ –ø–æ–ª—É—á–∞–µ—Ç –∫–∞—Ä—Ç—É 20—Ö20—Ö3, –≥–¥–µ –Ω–∞ –æ–¥–Ω–æ–º –∫–∞–Ω–∞–ª–µ - —Å—Ç–µ–Ω–∞, –Ω–∞ –¥—Ä—É–≥–æ–º - —Ñ–∏–Ω–∏—à –∏ –Ω–∞ 3-–µ–º - –∏–≥—Ä–æ–∫. 
   ![2018-02-25 23.00.40](https://i.imgur.com/YPhsD1q.jpg)- ReLU (—Ñ—É–Ω–∫—Ü–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏) 
   –¢.–µ. —Ç–∞–º –¥–≤–∞ —Å–≤—ë—Ä—Ç–æ—á–Ω—ã—Ö —Å–ª–æ—è, –∞ –ø–æ—Ç–æ–º –¥–≤–∞ –ø–æ–ª–Ω–æ—Å–≤—è–∑–Ω—ã—Ö, –Ω—É –∏ –≤–µ–∑–¥–µ –∫—Ä–æ–º–µ –≤—ã—Ö–æ–¥–∞ —Ñ—É–Ω–∫—Ü–∏—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ - [ReLU](https://en.wikipedia.org/wiki/Rectifier_(neural_networks)).

**2. –ö–∞–∫ –æ–±—É—á–∞—Ç—å?**

–î–ª—è —ç—Ç–æ–≥–æ –º—ã –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ–º [MSE](https://en.wikipedia.org/wiki/Mean_squared_error):

![mse](https://i.imgur.com/KYN3yR8.jpg)

–¢.–µ. –Ω–∞—Ö–æ–¥—è—Å—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ s_t, eps-–∂–∞–¥–Ω–æ —Å –ø–æ–º–æ—â—å—é –Ω–µ–π—Ä–æ–Ω–∫–∏ –≤—ã–±–∏—Ä–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ *a* —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º *q-value*. –ü–æ–ª—É—á–∞–µ–º –Ω–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ s_{t+1} –∏ –Ω–∞–≥—Ä–∞–¥—É r_t, —Å –ø–æ–º–æ—â—å—é –Ω–∏—Ö –æ–±—É—á–∞–µ–º –Ω–µ–π—Ä–æ–Ω–∫—É –Ω–∞ –ª–æ—Å—Å –≤—ã—à–µ, —Ç–æ —á—Ç–æ —Å—Ç–æ–∏—Ç —Å–ø—Ä–∞–≤–∞ –ø—Ä–∏ —ç—Ç–æ–º —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–æ–π.

–ü—Ä–∏ —ç—Ç–æ–º, —Ç.–∫. –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–ª–∏—à–∫–æ–º –∫–æ—Ä—Ä–µ–ª–∏—Ä–æ–≤–∞–Ω—ã, –º—ã –¥–µ–ª–∞–µ–º *memory replay* - —Å–ø–∏—Å–æ–∫ –≤–∏–¥–∞ `(s, a, r, next_s, done)`, –≥–¥–µ *s - state, a - action, r - reward, next_s - next state*. 
–ò–∑ —ç—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞ –º—ã –±–µ—Ä–µ–º —Ä–∞–Ω–¥–æ–º–Ω—ã–µ –ø–æ–¥–≤—ã–±–æ—Ä–∫–∏ –∏ –æ–±—É—á–∞–µ–º –Ω–∞ –Ω–∏—Ö —Å–µ—Ç—å.



#### Rewards:

–ù–∞–≥—Ä–∞–¥—ã –∫–∞–∫ –∏ –±—ã–ª–∏ –≤ baseline: 

–¢.–µ. –∑–∞ —É–¥–∞—Ä –≤ —Å—Ç–µ–Ω—É *-1*, –¥–æ–π—Ç–∏ –¥–æ —Ñ–∏–Ω–∏—à–∞ *+10*, –∑–∞ –æ–±—ã—á–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—É–º–º–∞ —Ä–∞–∑–Ω–æ—Å—Ç–∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –æ—Ç —Ç–µ–∫—É—â–∏–π —Ç–æ—á–∫–∏ –¥–æ —Ñ–∏–Ω–∏—à–∞

*Note: –≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Ç.–∫. —Ç–∞–º —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–≤ —Ö–æ–¥–∞—Ö), –µ–≤–∫–ª–∏–¥–æ–≤–æ, –∏ –µ—à—ë –æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –∫ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é –æ—Ç —Å—Ç–∞—Ä—Ç–∞*.

#### Outputs:

–ù–∞ –≥—Ä–∞—Ñ–∏–∫–∞—Ö - –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ –∏–≥—Ä—É –∏ —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞–∏–±–æ–ª—å—à–µ–≥–æ *q-value*, –∫–æ—Ç–æ—Ä–æ–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–µ—Ç—å. 

![pic](https://i.imgur.com/uIlN2P2.png)

- –ß–µ–º –ª—É—á—à–µ reward, —Ç–µ–º –ª—É—á—à–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–π –ø—É—Ç—å. 


- *Q-value* –æ—Ç—Ä–∞–∂–∞–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Å–µ—Ç–∏ –≤ –≤—ã–±–∏—Ä–∞–µ–º–æ–º –¥–µ–π—Å—Ç–≤–∏–∏. 

*Note: –Ω–∞ –æ–±—É—á–µ–Ω–∏–∏ –≤—Å–µ–≥–¥–∞ –¥–æ–≤–æ–ª—å–Ω–æ –Ω–µ –æ—á–µ–Ω—å –ø–æ–ª—É—á–∏–ª–æ—Å—å üò´, –Ω–æ –ø—Ä–∏ —ç—Ç–æ–º –∫–∞–∫–∏–µ-—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å–µ—Ç—å –≤—Å—ë –∂–µ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç, –∏ –Ω–∞ test –¥–æ–æ–±—É—á–∞–µ—Ç—Å—è –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–µ.* 

##  üëæ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è:

![final](https://media.giphy.com/media/2jMpykkeFEneZrNouP/giphy.gif)





#### üí° Sources:

1. https://en.wikipedia.org/wiki/Q-learning
2. https://keon.io/deep-q-learning/
3. http://outlace.com/rlpart3.html
4. https://habrahabr.ru/post/279729/



